.PHONY: all install clean

all:
	cd /home/isucon/isucon4-qualifier_luajit-nginx-redis/lib/ngx_openresty-1.7.4.1/build/LuaJIT-2.1-20140805 && $(MAKE) TARGET_STRIP=@: CCDEBUG=-g Q= XCFLAGS='-DLUA_USE_APICHECK -DLUA_USE_ASSERT' CC=cc PREFIX=/home/isucon/isucon4-qualifier_luajit-nginx-redis/luajit
	cd /home/isucon/isucon4-qualifier_luajit-nginx-redis/lib/ngx_openresty-1.7.4.1/build/lua-cjson-2.1.0.2 && $(MAKE) DESTDIR=$(DESTDIR) LUA_INCLUDE_DIR=/home/isucon/isucon4-qualifier_luajit-nginx-redis/lib/ngx_openresty-1.7.4.1/build/luajit-root/home/isucon/isucon4-qualifier_luajit-nginx-redis/luajit/include/luajit-2.1 LUA_CMODULE_DIR=/home/isucon/isucon4-qualifier_luajit-nginx-redis/lualib LUA_MODULE_DIR=/home/isucon/isucon4-qualifier_luajit-nginx-redis/lualib CJSON_CFLAGS="-g -O -fpic" CC=cc
	cd /home/isucon/isucon4-qualifier_luajit-nginx-redis/lib/ngx_openresty-1.7.4.1/build/lua-redis-parser-0.10 && $(MAKE) DESTDIR=$(DESTDIR) LUA_INCLUDE_DIR=/home/isucon/isucon4-qualifier_luajit-nginx-redis/lib/ngx_openresty-1.7.4.1/build/luajit-root/home/isucon/isucon4-qualifier_luajit-nginx-redis/luajit/include/luajit-2.1 LUA_LIB_DIR=/home/isucon/isucon4-qualifier_luajit-nginx-redis/lualib CFLAGS="-g -O -Wall" CC=cc
	cd /home/isucon/isucon4-qualifier_luajit-nginx-redis/lib/ngx_openresty-1.7.4.1/build/lua-rds-parser-0.05 && $(MAKE) DESTDIR=$(DESTDIR) LUA_INCLUDE_DIR=/home/isucon/isucon4-qualifier_luajit-nginx-redis/lib/ngx_openresty-1.7.4.1/build/luajit-root/home/isucon/isucon4-qualifier_luajit-nginx-redis/luajit/include/luajit-2.1 LUA_LIB_DIR=/home/isucon/isucon4-qualifier_luajit-nginx-redis/lualib CFLAGS="-g -O -Wall" CC=cc
	cd /home/isucon/isucon4-qualifier_luajit-nginx-redis/lib/ngx_openresty-1.7.4.1/build/nginx-1.7.4 && $(MAKE)

install: all
	cd /home/isucon/isucon4-qualifier_luajit-nginx-redis/lib/ngx_openresty-1.7.4.1/build/LuaJIT-2.1-20140805 && $(MAKE) install TARGET_STRIP=@: CCDEBUG=-g Q= XCFLAGS='-DLUA_USE_APICHECK -DLUA_USE_ASSERT' CC=cc PREFIX=/home/isucon/isucon4-qualifier_luajit-nginx-redis/luajit DESTDIR=$(DESTDIR)
	cd /home/isucon/isucon4-qualifier_luajit-nginx-redis/lib/ngx_openresty-1.7.4.1/build/lua-cjson-2.1.0.2 && $(MAKE) install DESTDIR=$(DESTDIR) LUA_INCLUDE_DIR=/home/isucon/isucon4-qualifier_luajit-nginx-redis/lib/ngx_openresty-1.7.4.1/build/luajit-root/home/isucon/isucon4-qualifier_luajit-nginx-redis/luajit/include/luajit-2.1 LUA_CMODULE_DIR=/home/isucon/isucon4-qualifier_luajit-nginx-redis/lualib LUA_MODULE_DIR=/home/isucon/isucon4-qualifier_luajit-nginx-redis/lualib CJSON_CFLAGS="-g -O -fpic" CC=cc
	cd /home/isucon/isucon4-qualifier_luajit-nginx-redis/lib/ngx_openresty-1.7.4.1/build/lua-redis-parser-0.10 && $(MAKE) install DESTDIR=$(DESTDIR) LUA_INCLUDE_DIR=/home/isucon/isucon4-qualifier_luajit-nginx-redis/lib/ngx_openresty-1.7.4.1/build/luajit-root/home/isucon/isucon4-qualifier_luajit-nginx-redis/luajit/include/luajit-2.1 LUA_LIB_DIR=/home/isucon/isucon4-qualifier_luajit-nginx-redis/lualib CFLAGS="-g -O -Wall" CC=cc
	cd /home/isucon/isucon4-qualifier_luajit-nginx-redis/lib/ngx_openresty-1.7.4.1/build/lua-rds-parser-0.05 && $(MAKE) install DESTDIR=$(DESTDIR) LUA_INCLUDE_DIR=/home/isucon/isucon4-qualifier_luajit-nginx-redis/lib/ngx_openresty-1.7.4.1/build/luajit-root/home/isucon/isucon4-qualifier_luajit-nginx-redis/luajit/include/luajit-2.1 LUA_LIB_DIR=/home/isucon/isucon4-qualifier_luajit-nginx-redis/lualib CFLAGS="-g -O -Wall" CC=cc
	cd /home/isucon/isucon4-qualifier_luajit-nginx-redis/lib/ngx_openresty-1.7.4.1/build/lua-resty-dns-0.13 && $(MAKE) install DESTDIR=$(DESTDIR) LUA_LIB_DIR=/home/isucon/isucon4-qualifier_luajit-nginx-redis/lualib INSTALL=/home/isucon/isucon4-qualifier_luajit-nginx-redis/lib/ngx_openresty-1.7.4.1/build/install
	cd /home/isucon/isucon4-qualifier_luajit-nginx-redis/lib/ngx_openresty-1.7.4.1/build/lua-resty-memcached-0.13 && $(MAKE) install DESTDIR=$(DESTDIR) LUA_LIB_DIR=/home/isucon/isucon4-qualifier_luajit-nginx-redis/lualib INSTALL=/home/isucon/isucon4-qualifier_luajit-nginx-redis/lib/ngx_openresty-1.7.4.1/build/install
	cd /home/isucon/isucon4-qualifier_luajit-nginx-redis/lib/ngx_openresty-1.7.4.1/build/lua-resty-redis-0.20 && $(MAKE) install DESTDIR=$(DESTDIR) LUA_LIB_DIR=/home/isucon/isucon4-qualifier_luajit-nginx-redis/lualib INSTALL=/home/isucon/isucon4-qualifier_luajit-nginx-redis/lib/ngx_openresty-1.7.4.1/build/install
	cd /home/isucon/isucon4-qualifier_luajit-nginx-redis/lib/ngx_openresty-1.7.4.1/build/lua-resty-mysql-0.15 && $(MAKE) install DESTDIR=$(DESTDIR) LUA_LIB_DIR=/home/isucon/isucon4-qualifier_luajit-nginx-redis/lualib INSTALL=/home/isucon/isucon4-qualifier_luajit-nginx-redis/lib/ngx_openresty-1.7.4.1/build/install
	cd /home/isucon/isucon4-qualifier_luajit-nginx-redis/lib/ngx_openresty-1.7.4.1/build/lua-resty-string-0.09 && $(MAKE) install DESTDIR=$(DESTDIR) LUA_LIB_DIR=/home/isucon/isucon4-qualifier_luajit-nginx-redis/lualib INSTALL=/home/isucon/isucon4-qualifier_luajit-nginx-redis/lib/ngx_openresty-1.7.4.1/build/install
	cd /home/isucon/isucon4-qualifier_luajit-nginx-redis/lib/ngx_openresty-1.7.4.1/build/lua-resty-upload-0.09 && $(MAKE) install DESTDIR=$(DESTDIR) LUA_LIB_DIR=/home/isucon/isucon4-qualifier_luajit-nginx-redis/lualib INSTALL=/home/isucon/isucon4-qualifier_luajit-nginx-redis/lib/ngx_openresty-1.7.4.1/build/install
	cd /home/isucon/isucon4-qualifier_luajit-nginx-redis/lib/ngx_openresty-1.7.4.1/build/lua-resty-websocket-0.04 && $(MAKE) install DESTDIR=$(DESTDIR) LUA_LIB_DIR=/home/isucon/isucon4-qualifier_luajit-nginx-redis/lualib INSTALL=/home/isucon/isucon4-qualifier_luajit-nginx-redis/lib/ngx_openresty-1.7.4.1/build/install
	cd /home/isucon/isucon4-qualifier_luajit-nginx-redis/lib/ngx_openresty-1.7.4.1/build/lua-resty-lock-0.03 && $(MAKE) install DESTDIR=$(DESTDIR) LUA_LIB_DIR=/home/isucon/isucon4-qualifier_luajit-nginx-redis/lualib INSTALL=/home/isucon/isucon4-qualifier_luajit-nginx-redis/lib/ngx_openresty-1.7.4.1/build/install
	cd /home/isucon/isucon4-qualifier_luajit-nginx-redis/lib/ngx_openresty-1.7.4.1/build/lua-resty-lrucache-0.02 && $(MAKE) install DESTDIR=$(DESTDIR) LUA_LIB_DIR=/home/isucon/isucon4-qualifier_luajit-nginx-redis/lualib INSTALL=/home/isucon/isucon4-qualifier_luajit-nginx-redis/lib/ngx_openresty-1.7.4.1/build/install
	cd /home/isucon/isucon4-qualifier_luajit-nginx-redis/lib/ngx_openresty-1.7.4.1/build/lua-resty-core-0.0.9 && $(MAKE) install DESTDIR=$(DESTDIR) LUA_LIB_DIR=/home/isucon/isucon4-qualifier_luajit-nginx-redis/lualib INSTALL=/home/isucon/isucon4-qualifier_luajit-nginx-redis/lib/ngx_openresty-1.7.4.1/build/install
	cd /home/isucon/isucon4-qualifier_luajit-nginx-redis/lib/ngx_openresty-1.7.4.1/build/lua-resty-upstream-healthcheck-0.03 && $(MAKE) install DESTDIR=$(DESTDIR) LUA_LIB_DIR=/home/isucon/isucon4-qualifier_luajit-nginx-redis/lualib INSTALL=/home/isucon/isucon4-qualifier_luajit-nginx-redis/lib/ngx_openresty-1.7.4.1/build/install
	cd /home/isucon/isucon4-qualifier_luajit-nginx-redis/lib/ngx_openresty-1.7.4.1/build/nginx-1.7.4 && $(MAKE) install DESTDIR=$(DESTDIR)
	cd /home/isucon/isucon4-qualifier_luajit-nginx-redis/lib/ngx_openresty-1.7.4.1/build && ./install resty $(DESTDIR)//home/isucon/isucon4-qualifier_luajit-nginx-redis/bin/

clean:
	rm -rf build
